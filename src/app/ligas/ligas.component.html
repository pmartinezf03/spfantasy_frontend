<div class="ligas-panel">
  <div *ngIf="ligaActual as liga">
    <div class="liga-activa-card">
      <h2 class="titulo-liga">
        🏆 Estás en la liga:
        <span>{{ liga.nombre }}</span>
      </h2>

      <button class="btn-salir-liga" (click)="salirLiga()">
        ❌ Salir de la liga
      </button>

      <!-- Dashboard -->
      <div class="liga-dashboard">
        <!-- Ranking -->
        <div class="ranking-card">
          <h3>🏆 Clasificación de la Liga</h3>
          <p-table [value]="ranking" [responsiveLayout]="'scroll'" class="p-datatable-sm">
            <ng-template pTemplate="header">
              <tr><th>#</th><th>Jugador</th><th>Puntos</th></tr>
            </ng-template>
            <ng-template pTemplate="body" let-row let-i="rowIndex">
              <tr>
                <td>{{ i + 1 }}</td>
                <td>👤 {{ row.nombre }}</td>
                <td><span class="puntos">{{ row.puntosTotales }}</span></td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Gráfico -->
        <div class="grafico-card">
          <p-chart
            type="bar"
            [data]="graficoPuntos"
            [options]="graficoOpciones"
            class="p-mb-4"
          ></p-chart>
        </div>

        <!-- Miembros -->
        <div class="miembros-grid">
          <div *ngFor="let miembro of miembros" class="miembro-card">
            <div class="avatar"><i class="pi pi-user"></i></div>
            <div class="info">
              <strong>{{ miembro.username }}</strong>
              <small>{{ miembro.email }}</small>
            </div>
          </div>
        </div>

        <!-- Actividad reciente -->
        <div class="actividad-card">
          <h3>📅 Actividad Reciente</h3>
          <ul class="actividad-list">
            <li *ngFor="let a of actividadReciente">
              🕒 {{ a.timestamp | date : "short" }} —
              <strong>{{ a.usuario.username }}</strong>: {{ a.descripcion }}
            </li>
          </ul>
        </div>
      </div>

      <app-gestionar-liga
        *ngIf="esCreador && !ligaIniciada"
        [liga]="liga"
        [miembros]="miembros"
        (expulsado)="cargarMiembros()"
        (ligaIniciada)="ligaIniciada = true"
      ></app-gestionar-liga>

      <app-esperando-miembros
        *ngIf="!esCreador || ligaIniciada"
        [liga]="liga"
        [miembros]="miembros"
      ></app-esperando-miembros>
    </div>
  </div>

  <!-- Vista si no estás en una liga -->
  <div *ngIf="!ligaActual" class="opciones-liga">
    <h2>⚙️ Gestión de Ligas</h2>

    <div class="acciones-liga">
      <button
        *ngIf="usuario?.role?.toLowerCase() === 'admin' || usuario?.role?.toLowerCase() === 'vip'"
        class="btn-crear"
        (click)="mostrarCrear()"
      >🎯 Crear Liga</button>

      <button class="btn-unirse" (click)="mostrarUnirse()">🚀 Unirse a Liga</button>
    </div>

    <div class="panel-dinamico">
      <app-crear-liga *ngIf="mostrarCrearLiga" (ligaCreada)="onLigaCreada($event)"></app-crear-liga>
      <app-unirse-liga *ngIf="mostrarUnirseLiga" (unido)="onUnidoALiga($event)"></app-unirse-liga>
    </div>
  </div>
</div>
